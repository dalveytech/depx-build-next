"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[474],{87798:function(e,t,n){n.d(t,{Fc:function(){return c},Fr:function(){return u},II:function(){return s},Pi:function(){return i},T$:function(){return o},ZF:function(){return r}});var i="wss://data-stream.binance.com/stream",s="https://data.binance.com/api/v3/",r="https://api.binance.us/api/v3",o="wss://stream.binance.us:9443/stream",c="https://api-cloud.bitmart.com/spot/v1",u="https://info.blex.io/api"},20243:function(e,t,n){n.d(t,{U:function(){return m}});var i=n(17061),s=n.n(i),r=n(17156),o=n.n(r),c=n(42122),u=n.n(c),a=n(56690),l=n.n(a),h=n(89728),f=n.n(h),p=n(87798),d=function(){function e(t){l()(this,e),this.url=t,this.socket=null,this.isOpened=!1,this.messageQueue=[],this.reconnectTimer=null,this.idCounter=1,this.reconnectCount=0,this.subscriptions=new Map,this.usingRestfulAPI=!1,this.isBehind=!1,this.isChangeing=!1,this.idleTime=9e5,this.initWebSocket()}var t,n;return f()(e,[{key:"initWebSocket",value:function(){var e=this;this.socket=new WebSocket(this.url),this.socket.onopen=function(){console.log("WebSocket connection onopen"),e.lastActiveTime=Date.now(),e.isOpened=!0,e.isBehind=!1,e.isChangeing=!1,e.usingRestfulAPI=!1,e.reconnectCount=0,e.sendCachedMessages(),e.stopReconnect(),e.checkIdleTimer=setInterval((function(){e.checkIdleTime()}),6e4)},this.socket.onmessage=function(t){return e.onMessage(t)};var t=this;this.socket.onclose=function(n){t.isOpened=!1,t.isBehind||t.isChangeing||e.reconnect(),console.log("WebSocket connection closed with code "+n.code+", reason: "+n.reason+", wasClean: "+n.wasClean),clearInterval(e.checkIdleTimer)},this.socket.onerror=function(t){console.log("WebSocket connection error",t),e.isOpened=!1}}},{key:"send",value:function(e){var t=this;if(1===this.socket.readyState)try{this.socket.send(JSON.stringify(e))}catch(e){console.error("WebSocket connection send error",e,this)}else console.log("WebSocket connection readyState fail"),setTimeout((function(){return t.send(e)}),1e3)}},{key:"reconnect",value:function(){console.log("WebSocket reconnecting..."),clearInterval(this.reconnectTimer);var e=this;this.isOpened=!1,this.reconnectTimer=setTimeout((function(){if(e.reconnectCount>=2)return console.error("WebSocket connection failed after multiple attempts."),e.stopReconnect(),e.usingRestfulAPI=!0,void e.pollRestfulAPI();e.reconnectCount++,e.initWebSocket()}),1e3)}},{key:"subscribe",value:function(e,t,n,i){var s=this.idCounter++,r=u()(u()({},e),{},{id:s});return this.subscriptions.set(s,{message:r,callback:t,predicate:n,restfulApiFunc:i}),this.usingRestfulAPI?this.pollRestfulAPI(s):this.isOpened?this.send(r):this.messageQueue.push(r),s}},{key:"onMessage",value:(n=o()(s()().mark((function e(t){var n;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=JSON.parse(t.data);try{this.subscriptions.forEach((function(e){var t=e.callback,i=e.predicate;void 0!==(null==n?void 0:n.error)?t(n.error,null):i(n)&&t(null,n)}))}catch(e){console.log("WebSocket connection onMessage error: ",e)}case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"checkIdleTime",value:function(){(console.log("WebSocket connection checkIdleTime...",{isOpened:this.isOpened,messageQueue:this.messageQueue,reconnectTimer:this.reconnectTimer,reconnectCount:this.reconnectCount,idCounter:this.idCounter,isBehind:this.isBehind,usingRestfulAPI:this.usingRestfulAPI,subscriptions:Array.from(this.subscriptions.values())}),"hidden"===document.visibilityState)&&(Date.now()-this.lastActiveTime>this.idleTime&&this.isOpened&&(console.log("WebSocket connection exceeds ".concat(this.idleTime," ms, closing...")),this.saveMessageQueue(),this.isBehind=!0,this.close()))}},{key:"saveMessageQueue",value:function(){this.messageQueue=Array.from(this.subscriptions.values()).map((function(e){return e.message})),console.log("WebSocket connection: 缓存的任务",this.messageQueue)}},{key:"handleVisibilityChange",value:function(){"hidden"===document.visibilityState?(console.log("WebSocket connection hidden"),this.checkIdleTime()):(console.log("WebSocket connection visible"),this.lastActiveTime=Date.now(),this.isOpened||this.reconnect())}},{key:"pollRestfulAPI",value:function(e){var t=this;e?this.pollRestfulAPIForSubscription(e):this.subscriptions.forEach((function(e,n){t.pollRestfulAPIForSubscription(n)}))}},{key:"pollRestfulAPIForSubscription",value:(t=o()(s()().mark((function e(t){var n,i,r,o,c;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.subscriptions.get(t),i=n.restfulApiFunc,r=n.callback,o=n.predicate,i){e.next=4;break}return e.abrupt("return");case 4:n.hasOwnProperty("shouldStop")||(n.shouldStop=!1);case 5:if(!this.usingRestfulAPI||n.shouldStop){e.next=20;break}return e.prev=6,e.next=9,i();case 9:c=e.sent,o(c)&&r(null,c),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(6),r(e.t0,null);case 16:return e.next=18,new Promise((function(e){return setTimeout(e,1e3)}));case 18:e.next=5;break;case 20:case"end":return e.stop()}}),e,this,[[6,13]])}))),function(e){return t.apply(this,arguments)})},{key:"stopPollingById",value:function(e){var t=this.subscriptions.get(e);t&&(t.shouldStop=!0)}},{key:"stopReconnect",value:function(){clearTimeout(this.reconnectTimer),this.reconnectTimer=null,this.reconnectCount=0}},{key:"unsubscribe",value:function(e,t){this.stopPollingById(e),this.subscriptions.delete(e),this.isOpened&&this.send(u()(u()({},t),{},{id:this.idCounter++}))}},{key:"sendCachedMessages",value:function(){if(this.isOpened)for(;this.messageQueue.length>0;)this.send(this.messageQueue.shift())}},{key:"changeUrl",value:function(e){this.isChangeing=!0,this.socket&&(this.saveMessageQueue(),this.socket.close()),this.url=e,console.log("WebSocket connection changeUrl",this.url),this.initWebSocket()}},{key:"close",value:function(){this.socket.close()}}]),e}(),m=new d(p.Pi);document.addEventListener("visibilitychange",(function(){m.handleVisibilityChange()}))},21650:function(e,t,n){n.d(t,{ET:function(){return h},FB:function(){return o},Qo:function(){return c},VZ:function(){return a},YO:function(){return u},bD:function(){return r},pQ:function(){return l}});var i=n(58926),s=n(24069),r=0,o="Long",c="Short",u="Market",a="Limit",l=((0,s.Jl)(1,30),{"5m":300,"15m":900,"1h":3600,"4h":14400,"1d":86400});function h(e,t){return t?(0,i.jY)(e)+"address/"+t:(0,i.jY)(e)}},36326:function(e,t,n){n.d(t,{K:function(){return d},Z:function(){return m}});var i=n(17061),s=n.n(i),r=n(17156),o=n.n(r),c=n(8433),u=n(27424),a=n.n(u);var l=function(e){var t=a()(e,5);return{time:t[0]/1e3,open:t[1],high:t[2],low:t[3],close:t[4]}},h=n(87798),f=n(20243),p=c.Z.create({baseURL:h.II,timeout:5e3}),d=function(e){return{getKLines:(i=o()(s()().mark((function t(n){var i,r,o,c,u,a,h,f;return s()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=n.symbol,r=n.period,o=n.startTime,c=n.endTime,u=n.limit,a=void 0===u?1e3:u,t.prev=1,h={symbol:i.toUpperCase(),interval:r,limit:a},o&&(h.startTime=o),c&&(h.endTime=c),t.next=7,e.get("klines",{params:h});case 7:if(!((f=t.sent).data&&f.data.length>0)){t.next=12;break}return t.abrupt("return",f.data.map(l));case 12:return t.abrupt("return",[]);case 13:t.next=19;break;case 15:return t.prev=15,t.t0=t.catch(1),console.log("getKLines: error",t.t0),t.abrupt("return",[]);case 19:case"end":return t.stop()}}),t,null,[[1,15]])}))),function(e){return i.apply(this,arguments)}),getPing:(n=o()(s()().mark((function t(){return s()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.get("ping");case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)}))),function(){return n.apply(this,arguments)}),subscribeKLine:function(e,t){var n=e.symbol,i=e.period,s="".concat(n,"@kline_").concat(i),r=f.U.subscribe({method:"SUBSCRIBE",params:[s]},t,(function(e){return e.stream===s}));return function(){f.U.unsubscribe(r,{method:"UNSUBSCRIBE",params:[s]})}},getTickerPrice:function(t){return e.get("ticker/price",{params:{symbol:t.toUpperCase()}})},get24HChange:(t=o()(s()().mark((function t(n){return s()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.get("ticker/24hr",{params:{symbol:n.toUpperCase()}}));case 1:case"end":return t.stop()}}),t)}))),function(e){return t.apply(this,arguments)}),subscribeTickerBatch:function(e,t,n){var i=f.U.subscribe({method:"SUBSCRIBE",params:e},t,(function(e){var t;return null==e||null===(t=e.stream)||void 0===t?void 0:t.includes("@ticker")}),n);return function(){f.U.unsubscribe(i,{method:"UNSUBSCRIBE",params:e})}}};var t,n,i},m=d(p)},99658:function(e,t,n){var i=n(8433),s=n(87798),r=n(36326),o=i.Z.create({baseURL:s.ZF,timeout:5e3});t.Z=(0,r.K)(o)},41519:function(e,t,n){n.d(t,{I:function(){return i}});var i=(0,n(6983).J)({key:"depx-user-preference"}).persistAtom},239:function(e,t,n){n.d(t,{O7:function(){return c},bI:function(){return u},tr:function(){return o}});var i=n(4480),s=n(36493),r=n(41519),o=(0,i.cn)({key:"marketsAtom",default:[],effects_UNSTABLE:[r.I]}),c=(0,i.cn)({key:"marketStoreAtom",default:{}}),u=(0,i.cn)({key:"marketSelectionAtom",default:"",effects_UNSTABLE:[r.I]});(0,i.nZ)({key:"symbolSelectionAtom",get:function(e){var t=(0,e.get)(u);return(0,s.do)(null==t?void 0:t.name).toLowerCase()}})}}]);